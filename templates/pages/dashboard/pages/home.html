{% extends 'pages/dashboard/base.html' %}

{% load webpack_static from webpack_loader %}

{% block css %}
  {{ block.super }}
  <style>
    a.custom-link {
      color: rgba(0, 0, 0, 0.8);
      text-decoration: none;
    }

    a.custom-link:hover {
      color: #7ad254 !important;
    }
  </style>
{% endblock %}
{% block content %}
  <div class="row">
    <div class="col-md-12">
      <div class="main-card add-organisation-card p-4 mt-5">
        <div class="ocard-left">
          <div class="ocard-avatar">
            <img src="{% webpack_static 'images/icons/profile.jpg' %}"
                 alt="{{ request.user }}" />
          </div>
          <div class="ocard-name">
            <h4>{{ request.user.get_username }}</h4>
            <span>Welcome</span>
          </div>
        </div>
        <div class="ocard-right">
          <button type="button" class="pe-4 ps-4 co-main-btn min-width px-2">Approve Organisation</button>
        </div>
      </div>
      <div class="main-card mt-4">
        <div class="dashboard-wrap-content">
          <div class="dashboard-report-content pt-4">
            <div class="row">
              <!-- Pending Requests -->
              <div class="col-xl-3 col-lg-6 col-md-6">
                <div class="dashboard-report-card purple">
                  <div class="card-content">
                    <div class="card-content">
                      <span class="card-title fs-6">Pending Request{{ event_requests_pending.count|pluralize }}</span>
                      <span class="card-sub-title fs-3">{{ event_requests_pending.count|default:'0' }}</span>
                      <div class="d-flex align-items-center">
                        <span><i class="ti ti-notification"></i></span>
                        <span class="font-12 color-body text-nowrap ms-2">Awaiting Approval</span>
                      </div>
                    </div>
                    <div class="card-media">
                      <i class="ti ti-building-airport"></i>
                    </div>
                  </div>
                </div>
              </div>
              <!-- Active Organisations -->
              <div class="col-xl-3 col-lg-6 col-md-6">
                <div class="dashboard-report-card red">
                  <div class="card-content">
                    <div class="card-content">
                      <span class="card-title fs-6">Active Organisation{{ clients.count|pluralize }}</span>
                      <span class="card-sub-title fs-3">{{ clients.count|default:'0' }}</span>
                      <div class="d-flex align-items-center">
                        <span><i class="ti ti-check"></i></span>
                        <span class="font-12 color-body text-nowrap ms-2">Fully Onboarded</span>
                      </div>
                    </div>
                    <div class="card-media">
                      <i class="ti ti-building"></i>
                    </div>
                  </div>
                </div>
              </div>
              <!-- Managed Events -->
              <div class="col-xl-3 col-lg-6 col-md-6">
                <div class="dashboard-report-card info">
                  <div class="card-content">
                    <div class="card-content">
                      <span class="card-title fs-6">Managed Events</span>
                      <span class="card-sub-title fs-3">32</span>
                      <div class="d-flex align-items-center">
                        <span><i class="ti ti-calendar-event"></i></span>
                        <span class="font-12 color-body text-nowrap ms-2">Across All Tenants</span>
                      </div>
                    </div>
                    <div class="card-media">
                      <i class="ti ti-calendar"></i>
                    </div>
                  </div>
                </div>
              </div>
              <!-- Support Tickets -->
              <div class="col-xl-3 col-lg-6 col-md-6">
                <div class="dashboard-report-card success">
                  <div class="card-content">
                    <div class="card-content">
                      <span class="card-title fs-6">Support Requests</span>
                      <span class="card-sub-title fs-3">0</span>
                      <div class="d-flex align-items-center">
                        <span><i class="ti ti-messages"></i></span>
                        <span class="font-12 color-body text-nowrap ms-2">Open Issues</span>
                      </div>
                    </div>
                    <div class="card-media">
                      <i class="ti ti-headset"></i>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <!-- end row -->
          </div>
        </div>
      </div>
    </div>
    <div class="col-12">
      <div class="row py-md-5 py-3">
        <div class="col-md-9 col-12">
          <table id="event-requests" class="table table-striped table-bordered">
            <thead>
              <tr>
                <th>Full Name</th>
                <th>Email</th>
                <th>Phone</th>
                <th>Manager</th>
                <th>Subdomain</th>
                <th>Plan</th>
                <th>Status</th>
                <th>Handled</th>
                <th>Created</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody>
              {% for row in event_requests %}
                <tr>
                  <td>{{ row.full_name|title }}</td>
                  <td>{{ row.email }}</td>
                  <td>{{ row.phone }}</td>
                  <td>{{ row.managed_by.user.email }}</td>
                  {% with url=request.scheme|add:'://'|add:row.subdomain|add:'.'|add:request.get_host %}
                    <td>
                      <a href="javascript:void(0)" class="custom-link">{{ url }}</a>
                    </td>
                  {% endwith %}
                  <td>{{ row.plan.name }}</td>
                  <td>{{ row.get_status_display }}</td>
                  <td>{{ row.handled }}</td>
                  <td>{{ row.created_at }}</td>
                  <td>
                    <button class="btn btn-sm btn-primary"
                            type="button"
                            data-bs-toggle="offcanvas"
                            data-bs-target="#eventCanvas{{ row.id }}"
                            aria-controls="offcanvasBottom"
                            data-id="{{ row.id }}">View</button>
                  </td>
                </tr>
                {% include 'offcanvas/events.request.html' with event=row form=event_requests_form %}
              {% endfor %}
            </tbody>
          </table>
        </div>
        <div class="col-md-3 col-12 chart">
          <canvas id="eventStatusChart"
                  width="400"
                  height="400"
                  data-endpoint="{% url 'api:api-events:event_status_chart' %}"></canvas>
        </div>
      </div>
    </div>
  </div>
{% endblock %}
